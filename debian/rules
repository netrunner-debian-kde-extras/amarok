#!/usr/bin/make -f

# TopGit support
ifneq (,$(shell which tg))
TG_BRANCHES := $(filter-out debian/mysqle_linkage_fix debian/aboutdata_add_debian_version_feature,$(shell tg summary -t))
endif
include /usr/share/quilt/quilt.make
-include /usr/share/topgit/tg2quilt.mk

DH := dh --with quilt
DEB_KDE_LINK_WITH_AS_NEEDED := yes

# See debian/patches/debian/aboutdata_add_debian_version_feature.diff
DEBIAN_PACKAGE_VERSION := $(shell dpkg-parsechangelog | grep '^Version:' | sed 's/^Version:[[:space:]]*\([^[:space:]]\+\).*$$/\1/')
DEB_CMAKE_CUSTOM_FLAGS += -DDEBIAN_PACKAGE_VERSION="$(DEBIAN_PACKAGE_VERSION)"

include debian/debhelper/kde.mk

override_dh_bugfiles:
	dh_bugfiles -A

override_dh_install:
	dh_install
	# Copy English errmsg.sys from mysql-server package
	if [ -d debian/amarok-common ]; then \
	    cp -a /usr/share/mysql/english/errmsg.sys debian/amarok-common/usr/share/kde4/apps/amarok/mysqle/; \
	fi

.PHONY: /usr/share/topgit/tg2quilt.mk
